<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { 
            background: #f0f8ff; 
            border: 1px solid #4a90e2; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
        .success { background: #d4edda; border-color: #28a745; }
        .error { background: #f8d7da; border-color: #dc3545; }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è</h1>
    
    <div id="testResults"></div>
    
    <button onclick="runTests()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã</button>
    <button onclick="toggleKpInfo()">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –ö–ü</button>
    <button onclick="checkCurrentState()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</button>

    <script>
        function runTests() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤:</h2>';
            
            // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const kpContent = document.getElementById('kpInfoContent');
            const toggleBtn = document.querySelector('.btn-kp-info-toggle');
            const bitrixBtn = document.querySelector('.btn-bitrix-profile');
            
            addTestResult('–ù–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ kpInfoContent', !!kpContent);
            addTestResult('–ù–∞–ª–∏—á–∏–µ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è', !!toggleBtn);
            addTestResult('–ù–∞–ª–∏—á–∏–µ –∫–Ω–æ–ø–∫–∏ –ë–∏—Ç—Ä–∏–∫—Å', !!bitrixBtn);
            
            // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            if (kpContent) {
                const isVisible = kpContent.classList.contains('kp-info-content--visible');
                addTestResult('–ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: —Ñ–æ—Ä–º–∞ –≤–∏–¥–Ω–∞', isVisible);
            }
            
            // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é toggleKpInfo
            if (typeof window.toggleKpInfo === 'function') {
                addTestResult('–§—É–Ω–∫—Ü–∏—è toggleKpInfo —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', true);
            } else {
                addTestResult('–§—É–Ω–∫—Ü–∏—è toggleKpInfo —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', false);
            }
        }
        
        function addTestResult(testName, passed) {
            const results = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = `test-result ${passed ? 'success' : 'error'}`;
            div.innerHTML = `${passed ? '‚úÖ' : '‚ùå'} ${testName}: ${passed ? '–ü–†–û–ô–î–ï–ù' : '–ü–†–û–í–ê–õ–ï–ù'}`;
            results.appendChild(div);
        }
        
        function checkCurrentState() {
            const kpContent = document.getElementById('kpInfoContent');
            const bitrixBtn = document.querySelector('.btn-bitrix-profile');
            
            if (!kpContent) {
                alert('‚ùå –≠–ª–µ–º–µ–Ω—Ç kpInfoContent –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            
            const isVisible = kpContent.classList.contains('kp-info-content--visible');
            const isHidden = kpContent.classList.contains('kp-info-content--hidden');
            
            let message = `üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:\n\n`;
            message += `‚Ä¢ –§–æ—Ä–º–∞ –ö–ü: ${isVisible ? '–í–ò–î–ù–ê' : '–°–ö–†–´–¢–ê'}\n`;
            message += `‚Ä¢ –ö–ª–∞—Å—Å --visible: ${isVisible}\n`;
            message += `‚Ä¢ –ö–ª–∞—Å—Å --hidden: ${isHidden}\n`;
            
            if (bitrixBtn) {
                const btnVisible = bitrixBtn.offsetParent !== null;
                message += `‚Ä¢ –ö–Ω–æ–ø–∫–∞ –ë–∏—Ç—Ä–∏–∫—Å: ${btnVisible ? '–í–ò–î–ù–ê' : '–°–ö–†–´–¢–ê'}\n`;
            }
            
            alert(message);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ toggleKpInfo (–∫–æ–ø–∏—è –∏–∑ ui.js)
        (function () {
            const SECTION_ID = "kpInfoContent";
            const BTN_SEL = ".btn-kp-info-toggle";
            const LS_KEY = "kpInfoOpen";

            function getEls() {
                return {
                    section: document.getElementById(SECTION_ID),
                    btn: document.querySelector(BTN_SEL),
                };
            }

            function applyState(open) {
                const { section, btn } = getEls();
                if (!section || !btn) return;

                section.classList.toggle("kp-info-content--visible", open);
                section.classList.toggle("kp-info-content--hidden", !open);
                
                const arrow = btn.querySelector('.toggle-arrow');
                if (arrow) {
                    arrow.style.transform = open ? 'rotate(0deg)' : 'rotate(-90deg)';
                }

                btn.setAttribute("aria-expanded", String(open));
                btn.setAttribute("aria-controls", SECTION_ID);

                try { localStorage.setItem(LS_KEY, open ? "1" : "0"); } catch (_) {}
            }

            function toggleKpInfo(force) {
                const { section } = getEls();
                if (!section) return;

                const wantOpen =
                    typeof force === "boolean" ? force : !section.classList.contains("kp-info-content--visible");

                applyState(wantOpen);
            }

            document.addEventListener("DOMContentLoaded", () => {
                const saved =
                    (typeof localStorage !== "undefined" && localStorage.getItem(LS_KEY)) || "0";
                applyState(saved === "1");
            });

            window.toggleKpInfo = toggleKpInfo;
        })();
    </script>
</body>
</html>
